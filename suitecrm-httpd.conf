###############################################################################
#
# DO NOT EDIT THIS FILE
#
# Use the "SuiteCRM" macro to define instances as needed in other
# configuration files.
#
###############################################################################

# Define a SuiteCRM instance
#
# Use this within a server config or virtual host context to define a
# SuiteCRM instance %{instance} (matching the systemd instance name)
# for a URL location %{location}
#
<Macro SuiteCRM %{instance} %{location}>
    Alias %{location}/cache /var/cache/suitecrm/%{instance}/cache
    Alias %{location} /usr/share/suitecrm/code
    <LocationMatch %{location}.*\.php$>
        SetHandler proxy:unix:/run/suitecrm/%{instance}/php-fpm.sock|fcgi://
    </LocationMatch>
</Macro>

# SuiteCRM code directory
#
# There is no user data within this directory.
#
<Directory /usr/share/suitecrm/code>

    # Grant access by default, matching the SuiteCRM .htaccess file
    #
    AllowOverride None
    Options None
    Require all granted

    # Configure index
    #
    DirectoryIndex index.php

</Directory>

# SuiteCRM cache directory
#
# This directory includes generated content including PHP code
# fragments.
#
# The SuiteCRM default .htaccess file blocks access to any .php or
# .tpl files within the cache directory.  Eeplicate that restriction
# here.
#
<Directory /var/cache/suitecrm/*/cache>

    # Grant access by default, matching the SuiteCRM .htaccess file
    #
    AllowOverride None
    Options None
    Require all granted

    # Block access to .php and .tpl files
    #
    <FilesMatch \.(php|tpl)$>
        Require all denied
    </FilesMatch>

</Directory>

# Block access to the diagnostics subdirectory of the cache directory
#
# The SuiteCRM default .htaccess file blocks access to the diagnostics
# subdirectory.  Replicate that restriction here.
#
<Directory /var/cache/suitecrm/*/cache/diagnostic>
    Require all denied
</Directory>
